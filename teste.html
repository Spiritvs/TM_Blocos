<!DOCTYPE html>
<html>
	<title>XtrmPixel</title>
	<head>
		<link href="style.css" rel="stylesheet" type="text/css" />
	</head>
	<body onload="init()">
		<canvas id="myCanvas" width="500" height="500"></canvas>
		<div id="texto" width="500" height="30"></div>
	</body>
	<script>
		var xMax = 20;
		var yMax = 20;
		var larg = 25;
		var f = new Array();
		var boxes = new Array();
		var c = document.getElementById("myCanvas");
		var ctx = c.getContext("2d");
		window.addEventListener('keydown', keyP, false);

		function init() {
			geraArray();
			addRect(0, 5, 5, larg, larg, "green");
		}

		function geraArray() {
			for (var x = 0; x < xMax; x++) {
				f[x] = new Array();
				for (var y = 0; y < yMax; y++) {
					f[x][y] = 0;
					//alert(f[x][y]);
				}
			}
		}

		function addRect(id, x, y, w, h, fill) {
			var rect = new Box(id, x, y, w, h, fill);
			boxes.push(rect);
			geraQuad(x, y, w, h, fill);
		}

		function Box(id, x, y, w, h, fill) {
			this.id = id;
			this.x = x;
			this.y = y;
			this.w = w;
			this.h = h;
			this.fill = fill;
		}

		function geraQuad(x, y, w, h, fill) {
			f[x][y] = 1;
			//alert(f[x][y]);
			x = x * larg;
			y = y * larg;
			ctx.fillStyle = fill;
			ctx.fillRect(x, y, w, h);
		};

		function clearCanvas(x, y, w, h) {
			f[x][y] = 0;
			//c.width = c.width;
			x = x * larg;
			y = y * larg;
			ctx.clearRect(x, y, larg, larg);
		}

		// {"comando":"up","id",3}
		function mKeyP(msg) {
			//console.log(msg.id);
			//console.log(msg.comando);
			var aux = 0;
			switch(msg.comando) {
				case"up":
					aux = boxes[msg.id].y;
					clearCanvas(boxes[msg.id].x, boxes[msg.id].y, boxes[msg.id].w, boxes[msg.id].h);
					if (boxes[msg.id].y < 0) {
						boxes[msg.id].y = aux;
					};
					if (f[boxes[msg.id].x][boxes[msg.id].y - 1] == 0) {
						boxes[msg.id].y--;
					};
					geraQuad(boxes[msg.id].x, boxes[msg.id].y, boxes[msg.id].w, boxes[msg.id].h, boxes[msg.id].fill);
					break;
				case"down":
					aux = boxes[msg.id].y;
					clearCanvas(boxes[msg.id].x, boxes[msg.id].y, boxes[msg.id].w, boxes[msg.id].h);
					if (boxes[msg.id].y >= yMax) {
						boxes[msg.id].y = aux;
					};
					if (f[boxes[msg.id].x][boxes[msg.id].y + 1] == 0) {
						boxes[msg.id].y++;
					};
					geraQuad(boxes[msg.id].x, boxes[msg.id].y, boxes[msg.id].w, boxes[msg.id].h, boxes[msg.id].fill);
					break;
				case"left":
					alert(boxes[msg.id].x);
					aux = boxes[msg.id].x;
					clearCanvas(boxes[msg.id].x, boxes[msg.id].y, boxes[msg.id].w, boxes[msg.id].h);
					if (boxes[msg.id].x < 0) {
						boxes[msg.id].x = aux;
					};
					if (f[boxes[msg.id].x - 1][boxes[msg.id].y] == 0) {
						boxes[msg.id].x--;
					};
					geraQuad(boxes[msg.id].x, boxes[msg.id].y, boxes[msg.id].w, boxes[msg.id].h, boxes[msg.id].fill);
					break;
			}
		}

		function keyP(e) {
			//alert(e.keyCode);
			var id;
			var comando;
			var aux = 0;
			switch(e.keyCode) {
				case 83:
					id = 0;
					comando = "down";
					break;
				case 87:
					id = 0;
					comando = "up";
					break;
				case 68:
					id = 0;
					comando = "right";
					break;
				case 65:
					id = 0;
					comando = "left";
					break;
			}
			msg = {
				"comando" : comando,
				"id" : id
			};
			mKeyP(msg);
		};
	</script>
</html>